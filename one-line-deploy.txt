# ðŸš€ One-Line Deployment Command
# Copy and paste this into your SSH session: ssh root@168.231.115.219

curl -fsSL https://raw.githubusercontent.com/bashhh89/propilot/main/quick-deploy.sh | bash

# OR if the above doesn't work, run these commands step by step:

# 1. Update system and install Node.js
apt update && apt upgrade -y
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs nginx git ufw
npm install -g pm2

# 2. Setup firewall
ufw --force enable && ufw allow ssh && ufw allow 80 && ufw allow 443

# 3. Clone and setup app
mkdir -p /var/www/procurement-ai && cd /var/www/procurement-ai
git clone https://github.com/bashhh89/propilot.git .
npm install

# 4. Create environment file
cat > .env << 'EOF'
OPENWEBUI_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjI1ZTIyODVkLTI0NTUtNGQyMS1iZGJkLWNiYzYwYTlhN2RjYyJ9.hJGAazDC0Dm9JS3n-2ngWPTr7IZ_ggSJPEe9fVtX2rw
OPENWEBUI_BASE_URL=https://socialgarden-openwebui.vo0egb.easypanel.host
PORT=3000
NODE_ENV=production
EOF

# 5. Create PM2 config
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'procurement-ai-copilot',
    script: 'server.js',
    instances: 1,
    env: { NODE_ENV: 'production', PORT: 3000 },
    autorestart: true,
    max_restarts: 10,
    min_uptime: '10s'
  }]
};
EOF

# 6. Setup Nginx
cat > /etc/nginx/sites-available/procurement-ai << 'EOF'
server {
    listen 80;
    server_name _;
    client_max_body_size 50M;
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF

# 7. Enable site and start services
ln -sf /etc/nginx/sites-available/procurement-ai /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
systemctl restart nginx
pm2 start ecosystem.config.js
pm2 save
pm2 startup

# 8. Check status
pm2 status
echo "ðŸŽ‰ Visit: http://168.231.115.219"